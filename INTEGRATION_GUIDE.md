# ğŸš€ v2.1 Features Integration Guide

## Adding Location Facts Panel + Filters to Family Tree Memory Maker

---

## ğŸ“ Files to Add

Copy these to your project:

```
src/components/
â”œâ”€â”€ location-facts-panel.tsx   â† NEW
â”œâ”€â”€ tree-filters.tsx           â† NEW
```

And update (from untangle-package):
```
supabase/functions/historical-context/index.ts  â† REPLACE
tailwind.config.ts                               â† REPLACE (has Dirk's gray)
```

---

## ğŸ”‘ Step 1: Add Claude API Key to Supabase

1. Go to [supabase.com](https://supabase.com) dashboard
2. Select your project
3. **Settings** â†’ **Edge Functions** â†’ **Secrets**
4. Add new secret:
   - Name: `ANTHROPIC_API_KEY`
   - Value: `sk-ant-...` (your key)

---

## ğŸ”§ Step 2: Integrate Tree Filters

### In your main tree view (e.g., `family-tree-app.tsx`):

```tsx
import { useState } from 'react';
import { TreeFiltersPanel, applyFilters, DEFAULT_FILTERS, type TreeFilters } from '@/components/tree-filters';

function FamilyTreeApp() {
  const [filters, setFilters] = useState<TreeFilters>(DEFAULT_FILTERS);
  
  // Assuming you have people from GEDCOM
  const [allPeople, setAllPeople] = useState<Person[]>([]);
  
  // Apply filters
  const filteredPeople = applyFilters(allPeople, filters);
  
  return (
    <div className="flex gap-4">
      {/* Sidebar with filters */}
      <aside className="w-80">
        <TreeFiltersPanel
          people={allPeople}
          filters={filters}
          onFiltersChange={setFilters}
          onReset={() => setFilters(DEFAULT_FILTERS)}
        />
      </aside>
      
      {/* Main tree view */}
      <main className="flex-1">
        <p className="text-sm text-muted-foreground mb-4">
          Showing {filteredPeople.length} of {allPeople.length} people
        </p>
        
        {/* Your existing tree visualization */}
        <TreeView people={filteredPeople} />
      </main>
    </div>
  );
}
```

---

## ğŸ”§ Step 3: Integrate Location Facts Panel

### Make locations clickable in your person cards:

```tsx
import { useState } from 'react';
import { LocationFactsPanel } from '@/components/location-facts-panel';

function PersonCard({ person, allPeople }) {
  const [selectedLocation, setSelectedLocation] = useState<string | null>(null);
  
  // Find all people at the same location
  const peopleAtLocation = selectedLocation 
    ? allPeople.filter(p => 
        p.birthPlace?.includes(selectedLocation) || 
        p.deathPlace?.includes(selectedLocation)
      )
    : [];
  
  return (
    <div className="relative">
      {/* Person info */}
      <h3>{person.name}</h3>
      
      {/* Clickable birth place */}
      {person.birthPlace && (
        <button
          onClick={() => setSelectedLocation(person.birthPlace)}
          className="text-sm text-blue-500 hover:underline flex items-center gap-1"
        >
          <MapPin className="h-3 w-3" />
          {person.birthPlace}
        </button>
      )}
      
      {/* Location Facts Panel (shows on click) */}
      {selectedLocation && (
        <div className="absolute top-0 right-0 z-50">
          <LocationFactsPanel
            location={selectedLocation}
            person={person}
            allPeopleAtLocation={peopleAtLocation}
            onClose={() => setSelectedLocation(null)}
          />
        </div>
      )}
    </div>
  );
}
```

---

## ğŸ¨ Using Dirk's Gray

After updating `tailwind.config.ts`:

```tsx
// Background
<div className="bg-dirk">Pure 120,120,120</div>
<div className="bg-dirk-100">Light gray</div>
<div className="bg-dirk-900">Almost black</div>

// Text
<p className="text-dirk-600">Darker gray text</p>

// Borders
<div className="border-2 border-dirk">Dirk border</div>

// Full scale available: dirk-50 through dirk-900
```

---

## ğŸ§ª Testing the Claude Integration

Once you've added the API key to Supabase:

1. Click a location in the app
2. The Location Facts Panel opens
3. Click "What was [location] like in the [decade]?"
4. You should see:
   - Historical context generated by Claude
   - A badge showing "via anthropic"

If it shows "via lovable" or "via google", your Anthropic key isn't set correctly.

---

## ğŸ“Š Filter Features

| Filter | Description |
|--------|-------------|
| **Search** | Type to search names |
| **Surname** | Multi-select surnames from your tree |
| **Region** | US regions (New England, etc.) |
| **Location** | Specific places from your data |
| **Date Range** | Birth year from/to |
| **Living/Deceased** | Toggle visibility |
| **Has Audio/Photos** | Filter by media |

---

## ğŸ”„ How Filters Work

```
All People â†’ applyFilters(people, filters) â†’ Filtered People â†’ Display
```

The `applyFilters` function handles all the logic:
- Checks each filter type
- Returns only matching people
- Efficient even with large datasets

---

## ğŸ’¡ Tips

### Performance
- Filters use `useMemo` to avoid recalculating on every render
- Large trees (1000+ people) should still feel snappy

### UX
- Active filter count shows as badge
- Click X on tags to remove individual filters
- Reset button clears everything

### Historical Context
- Only available if person has a date
- Uses birth year to determine era
- Asks about migration patterns by default

---

## ğŸ› Troubleshooting

### "No AI API key configured"
â†’ Check Supabase Edge Functions Secrets

### Filters not showing any surnames
â†’ Make sure GEDCOM was imported with surname parsing

### Location facts empty
â†’ The person might not have location data in their GEDCOM

### Historical context not loading
â†’ Check browser console for errors
â†’ Verify Supabase function is deployed

---

*Family Tree Memory Maker v2.1 "Autumn Heritage"*
